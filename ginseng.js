function getPreciseIntervalStr(interval){var duration=moment.duration(interval);if(duration.asMinutes()<=1)return"<1 min";if(duration.asYears()>=1)return Math.round(duration.asYears()*10)/10+" years";if(duration.asMonths()>=1)return Math.round(duration.asMonths()*10)/10+" months";if(duration.asWeeks()>=1)return Math.round(duration.asWeeks()*10)/10+" weeks";if(duration.asDays()>=1)return Math.round(duration.asDays()*10)/10+" days";if(duration.asHours()>=1)return Math.round(duration.asHours()*10)/10+" hours";if(duration.asMinutes()>=1)return Math.round(duration.asMinutes()*10)/10+" minutes"}function getShortPreciseIntervalStr(interval){var duration=moment.duration(interval);if(duration.asMinutes()<=1)return"<1 min";if(duration.asYears()>=1)return Math.round(duration.asYears()*10)/10+" y";if(duration.asMonths()>=1)return Math.round(duration.asMonths()*10)/10+" m";if(duration.asWeeks()>=1)return Math.round(duration.asWeeks()*10)/10+" w";if(duration.asDays()>=1)return Math.round(duration.asDays()*10)/10+" d";if(duration.asHours()>=1)return Math.round(duration.asHours()*10)/10+" h";if(duration.asMinutes()>=1)return Math.round(duration.asMinutes()*10)/10+" m"}var InfoBrowser=React.createClass({displayName:"InfoBrowser",getInitialState:function(){return{filterText:"",sortOrder:"1"}},onFilterChange:function(event){this.setState({filterText:event.target.value})},onRowSelect:function(index){this.props.onRowSelect(index)},changeSortOrder:function(order){var newOrder=order;if(this.state.sortOrder===order){newOrder+="r"}this.setState({sortOrder:newOrder})},render:function(){var thisBrowser=this;var sortedInfos=this.props.infos.sort(function(a,b){switch(thisBrowser.state.sortOrder){case"1":return a.fields[0].localeCompare(b.fields[0]);break;case"1r":return-a.fields[0].localeCompare(b.fields[0]);break;case"2":return a.fields[1].localeCompare(b.fields[1]);break;case"2r":return-a.fields[1].localeCompare(b.fields[1]);break;case"a":return moment(a.creationDate).isBefore(b.creationDate)?1:-1;break;case"ar":return moment(a.creationDate).isBefore(b.creationDate)?-1:1;break}});var maxAge=0;var age;var tableRows=[];var thData;for(var k=0;k<sortedInfos.length;++k){age=moment().diff(moment(sortedInfos[k].creationDate));if(age>maxAge){maxAge=age}}for(var i=0;i<sortedInfos.length;++i){age=moment().diff(moment(sortedInfos[i].creationDate));if(sortedInfos[i].fields[0].toLowerCase().indexOf(this.state.filterText.toLowerCase())!==-1||sortedInfos[i].fields[1].toLowerCase().indexOf(this.state.filterText.toLowerCase())!==-1){var ds=[];thData=[sortedInfos[i].fields[0],sortedInfos[i].fields[1],this.props.typeNames[sortedInfos[i].typeID],sortedInfos[i].tags.join(", "),getShortPreciseIntervalStr(age)];for(var j=0;j<thData.length;++j){var content;var shortenLen=j===2?5:15;if(thData[j].length>shortenLen){content=thData[j].slice(0,shortenLen)+"..."}else{content=thData[j]}if(j==4){ds.push(React.createElement("td",{key:j},React.createElement("div",{style:{position:"absolute"}},content),React.createElement("div",{style:{height:"1em",background:"#E0E0E0",width:age/maxAge*100+"%"}})))}else{ds.push(React.createElement("td",{key:j},content))}}tableRows.push(React.createElement("tr",{key:i,onClick:this.onRowSelect.bind(this,i)},ds))}}var th_1="1st";var th_2="2nd";var th_age="Age";switch(this.state.sortOrder){case"1":th_1+="↓";break;case"1r":th_1+="↑";break;case"2":th_2+="↓";break;case"2r":th_2+="↑";break;case"a":th_age+="↓";break;case"ar":th_age+="↑";break}return React.createElement("div",{className:"InfoBrowser Component"},React.createElement("div",{className:"browseControls"},React.createElement("input",{type:"text",placeholder:"Quick filter...",value:this.state.filterText,onChange:this.onFilterChange}),React.createElement("span",{className:"button buttonGood",onClick:this.props.onNew},"New info")),React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{onClick:this.changeSortOrder.bind(this,"1")},th_1),React.createElement("th",{onClick:this.changeSortOrder.bind(this,"2")},th_2),React.createElement("th",null,"Type"),React.createElement("th",null,"Tags"),React.createElement("th",{onClick:this.changeSortOrder.bind(this,"a")},th_age))),React.createElement("tbody",null,tableRows)))}});var InfoEdit=React.createClass({displayName:"InfoEdit",getInitialState:function(){var infoNew=JSON.parse(JSON.stringify(this.props.info));if(Object.keys(infoNew).length===1){var fields=[];var reviews={};for(var i=0;i<this.props.types[this.props.info.typeID].fieldNames.length;++i){fields.push("");reviews[i]=[]}infoNew.fields=fields;infoNew.reviews=reviews;infoNew.tags=[];infoNew.creationDate=moment().format()}return{info:infoNew}},componentDidMount:function(){this.refs.firstTextbox.getDOMNode().focus()},componentWillUpdate:function(nextProps,nextState){},onTypeChange:function(newTypeID){var newInfo=JSON.parse(JSON.stringify(this.state.info));newInfo.typeID=newTypeID;var newFieldsLength=this.props.types[newTypeID].fieldNames.length;var sizeDiff=newFieldsLength-this.state.info.fields.length;if(sizeDiff>0){for(var i=0;i<sizeDiff;i++){newInfo.fields.push("")}}else if(sizeDiff<0){newInfo.fields=newInfo.fields.slice(0,newFieldsLength)}this.setState({info:newInfo})},onFieldEdit:function(fieldIndex,e){var newInfo=JSON.parse(JSON.stringify(this.state.info));newInfo.fields[fieldIndex]=e.target.value;this.setState({info:newInfo})},onTagsEdit:function(event){var newInfo=JSON.parse(JSON.stringify(this.state.info));if(event.target.value===""){newInfo.tags=[]}else{newInfo.tags=event.target.value.replace(/ /g,"").split(",")}this.setState({info:newInfo})},onSave:function(){this.props.onSave(this.state.info)},addUsedTag:function(nextTagStr){var newInfo=JSON.parse(JSON.stringify(this.state.info));newInfo.tags.push(nextTagStr);this.setState({info:newInfo})},render:function(){var data_elements=[];for(var fieldIdx=0;fieldIdx<this.state.info.fields.length;++fieldIdx){var element_name=this.props.types[this.state.info.typeID].fieldNames[fieldIdx];var refString=false;if(fieldIdx===0){refString="firstTextbox"}data_elements.push(React.createElement("section",{key:fieldIdx},React.createElement("h3",null,"Entry: ",element_name),React.createElement("textarea",{className:"sectionContent",ref:refString,value:this.state.info.fields[fieldIdx],onChange:this.onFieldEdit.bind(this,fieldIdx),rows:(this.state.info.fields[fieldIdx].match(/\n/g)||[]).length+1})))}var usedTagEls=[];var seperator;for(var index=0;index<this.props.usedTags.length;++index){if(this.state.info.tags.indexOf(this.props.usedTags[index])===-1){if(usedTagEls.length===0)seperator="";else seperator=", ";usedTagEls.push(React.createElement("a",{key:index,onClick:this.addUsedTag.bind(this,this.props.usedTags[index]),href:"#"},seperator+this.props.usedTags[index]))}}var isChanged=JSON.stringify(this.props.info)===JSON.stringify(this.state.info);return React.createElement("div",{className:"InfoEdit Component"},React.createElement("div",{className:"sectionContainer"},React.createElement(ITypeSwitcher,{typeNames:this.props.typeNames,selectedTypeID:this.state.info.typeID,onTypeChange:this.onTypeChange}),data_elements,React.createElement("section",null,React.createElement("h3",null,"Tags"),React.createElement("textarea",{className:"sectionContent",rows:1,type:"text",value:this.state.info.tags.join(", "),onChange:this.onTagsEdit}),React.createElement("div",{className:"sectionContent"},"used: ",usedTagEls))),React.createElement("div",{className:"flexContHoriz"},React.createElement("span",{className:"button buttonGood "+(isChanged?"disabled":""),onClick:this.onSave},this.props.saveButtonStr),React.createElement("span",{className:"button",onClick:this.props.cancelEdit},"Cancel"),React.createElement("span",{className:!this.props.onDelete?"invisible":""+" button buttonDanger",onClick:this.props.onDelete},"Delete")))}});var ITypeSwitcher=React.createClass({displayName:"ITypeSwitcher",onTypeChange:function(typeID){this.props.onTypeChange(typeID)},render:function(){var typeNameOptions=[];for(var typeID in this.props.typeNames){typeNameOptions.push(React.createElement("span",{className:"button"+(this.props.selectedTypeID===typeID?" buttonGood":""),key:typeID,onClick:this.onTypeChange.bind(this,typeID)},this.props.typeNames[typeID]))}if(this.props.onAddType){typeNameOptions.push(React.createElement("span",{className:"button",key:"new",onClick:this.props.onAddType},"New.."))}return React.createElement("section",null,React.createElement("h3",null,"Info type"),React.createElement("div",{className:"sectionContent wrap"},typeNameOptions))}});var InfoTypes=React.createClass({displayName:"InfoTypes",getInitialState:function(){var firstTypeID=0;while(!(firstTypeID in this.props.infoTypes)){firstTypeID++}return{selectedTypeID:firstTypeID.toString(),newInfoTypes:this.props.infoTypes,changes:{renames:"",typeResizes:[]},mode:"main"}},onFieldNameEdit:function(fieldNameIndex,event){var newTypes=JSON.parse(JSON.stringify(this.state.newInfoTypes));newTypes[this.state.selectedTypeID].fieldNames[fieldNameIndex]=event.target.value;var newchanges=JSON.parse(JSON.stringify(this.state.changes));newchanges.renames="renamed";this.setState({newInfoTypes:newTypes,changes:newchanges})},selectType:function(newID){this.setState({selectedTypeID:newID})},onNameEdit:function(event){var newTypes=JSON.parse(JSON.stringify(this.state.newInfoTypes));newTypes[this.state.selectedTypeID].name=event.target.value;var newchanges=JSON.parse(JSON.stringify(this.state.changes));newchanges.renames="renamed";this.setState({newInfoTypes:newTypes,changes:newchanges})},onFieldsResize:function(fieldNameIndex){var newTypes=JSON.parse(JSON.stringify(this.state.newInfoTypes));if(fieldNameIndex===-1){newTypes[this.state.selectedTypeID].fieldNames.push("")}else{newTypes[this.state.selectedTypeID].fieldNames.splice(fieldNameIndex,1)}var newchanges=JSON.parse(JSON.stringify(this.state.changes));newchanges.typeResizes.push({id:this.state.selectedTypeID,fieldNameIndex:fieldNameIndex});this.setState({newInfoTypes:newTypes,changes:newchanges})},onSave:function(){this.props.onSave(this.state.newInfoTypes,this.state.changes)},onAddType:function(){var new_infoTypes=JSON.parse(JSON.stringify(this.state.newInfoTypes));var nextTypeID="0";for(var typeID in new_infoTypes){if(parseInt(typeID,10)>parseInt(nextTypeID,10)){nextTypeID=typeID}}nextTypeID=(parseInt(nextTypeID,10)+1).toString();new_infoTypes[nextTypeID]={name:"new info type",fieldNames:["first field","second field"],views:{0:{front:"{front}",back:"{back}",condition:""},1:{front:"{back}",back:"{front}",condition:"tag: reverse"}}};this.setState({newInfoTypes:new_infoTypes,selectedTypeID:nextTypeID})},setMode:function(modeStr){this.setState({mode:modeStr})},onViewChange:function(type,newContent){var new_infoTypes=JSON.parse(JSON.stringify(this.state.newInfoTypes));new_infoTypes[this.state.selectedTypeID].views[this.state.mode][type]=newContent;this.setState({newInfoTypes:new_infoTypes})},render:function(){var iType_elements=[];var selectedType=this.state.newInfoTypes[this.state.selectedTypeID];for(var i=0;i<selectedType.fieldNames.length;++i){iType_elements.push(React.createElement("div",{key:i,className:"sectionContent"},React.createElement("input",{className:"sectionContentEl",value:selectedType.fieldNames[i],onChange:this.onFieldNameEdit.bind(this,i)}),React.createElement("span",{className:"button buttonDanger sectionContentElFixed"+(selectedType.fieldNames.length<=2?" invisible":""),onClick:this.onFieldsResize.bind(this,i)},"✖")))}var mainSection=[];if(this.state.mode!=="main"){mainSection=React.createElement(Views,{view:selectedType.views[this.state.mode],onViewChange:this.onViewChange})}else{mainSection.push(React.createElement("section",{key:0},React.createElement("h3",null,"Name"),React.createElement("input",{className:"sectionContent",type:"text",id:"typeName",value:selectedType.name,onChange:this.onNameEdit})));mainSection.push(React.createElement("section",{key:1},React.createElement("h3",null,"Entries ",React.createElement("span",{className:"button",onClick:this.onFieldsResize.bind(this,-1)},"+")),iType_elements))}var typeNames={};for(var key in this.state.newInfoTypes){typeNames[key]=this.state.newInfoTypes[key].name}var viewButtons=[];for(var viewID in selectedType.views){viewButtons.push(React.createElement("span",{key:viewID,className:"flexElemContHoriz button "+(this.state.mode===viewID?"buttonGood":""),onClick:this.setMode.bind(this,viewID)},"View "+viewID))}var isChanged=JSON.stringify(this.props.infoTypes)===JSON.stringify(this.state.newInfoTypes);return React.createElement("div",{className:"InfoTypes Component"},React.createElement("div",{className:"sectionContainer"},React.createElement(ITypeSwitcher,{typeNames:typeNames,selectedTypeID:this.state.selectedTypeID,onTypeChange:this.selectType,onAddType:this.onAddType}),React.createElement("section",{className:"sectionContent tabContainer"},React.createElement("span",{className:"button "+(this.state.mode==="main"?"buttonGood":""),onClick:this.setMode.bind(this,"main")},"Main"),viewButtons),mainSection,React.createElement("section",{className:"sectionContent flexContHoriz"},React.createElement("span",{className:"flexElemContHoriz button buttonGood "+(isChanged?"disabled":""),onClick:this.onSave},"Save"),React.createElement("span",{className:"flexElemContHoriz button",onClick:this.props.cancelEdit},"Cancel"))))}});var Intervaller=React.createClass({displayName:"Intervaller",getInitialState:function(){console.log("construct intervalChoiceGroups");var intervalChoiceGroups=[],intervalChoiceGroup=[];var timeframeNameDict=["Minutes","Hours","Days","Weeks","Months","Relative"];for(var intervalGroupIndex=0;intervalGroupIndex<this.props.timeIntervalChoices.length;++intervalGroupIndex){if(this.props.timeIntervalChoices[intervalGroupIndex].length===0)continue;intervalChoiceGroup=[];for(var typeIndex=0;typeIndex<this.props.timeIntervalChoices[intervalGroupIndex].length;++typeIndex){intervalChoiceGroup.push(this.props.timeIntervalChoices[intervalGroupIndex][typeIndex])}intervalChoiceGroups.push({label:timeframeNameDict[intervalGroupIndex],members:intervalChoiceGroup.slice()})}return{modifyType:"change",changeType:"minutes",modifyAmount:10,activeKeyIndex:0,intervalChoiceGroups:intervalChoiceGroups}},onModeChange:function(newModeStr){if(newModeStr!==this.state.modifyType){var newActiveKeyIndex=this.state.activeKeyIndex;if(newModeStr==="set"&&this.state.changeType==="relative")newActiveKeyIndex=0;this.setState({modifyType:newModeStr,activeKeyIndex:newActiveKeyIndex})}},getNewInterval:function(){var intervalDiff;if(this.state.modifyType==="change"){if(this.state.changeType==="relative"){intervalDiff=this.props.reviewInterval*this.state.modifyAmount/100;return intervalDiff+this.props.reviewInterval}else{intervalDiff=moment.duration(this.state.modifyAmount,this.state.changeType.toLowerCase()).asMilliseconds();return this.props.reviewInterval+intervalDiff}}else if(this.state.modifyType==="set"){return moment.duration(this.state.modifyAmount,this.state.changeType.toLowerCase()).asMilliseconds()}},onIntervalChoice:function(modifyAmount,keyIndex,changeType,event){if(this.state.activeKeyIndex===keyIndex){this.props.applyInterval(this.getNewInterval())}this.setState({activeKeyIndex:keyIndex,changeType:changeType,modifyAmount:modifyAmount})},render:function(){var toolbarConents=[];var groupConents;var amount;var keyIndex=0;for(var i=0;i<this.state.intervalChoiceGroups.length;++i){groupConents=[];for(var j=0;j<this.state.intervalChoiceGroups[i].members.length;++j){var buttonClassName="button unselectable";buttonClassName+=" interval"+i%2;buttonClassName+=keyIndex===this.state.activeKeyIndex?" buttonSelected":"";var plusEL=React.createElement("span",{className:this.state.modifyType==="change"?"":"invisible"},"+");amount=this.state.intervalChoiceGroups[i].members[j];var buttonStr=amount;if(this.state.intervalChoiceGroups[i].label==="Relative")buttonStr+="%";else buttonStr+=this.state.intervalChoiceGroups[i].label.slice(0,1).toLowerCase();var labelElement=false;if(j===0){labelElement=React.createElement("div",null,this.state.intervalChoiceGroups[i].label)}var isSetAndRelative=this.state.intervalChoiceGroups[i].label==="Relative"&&this.state.modifyType==="set";toolbarConents.push(React.createElement("span",{key:keyIndex,className:isSetAndRelative?"invisible":""},labelElement,React.createElement("div",{className:buttonClassName,onClick:this.onIntervalChoice.bind(this,amount,keyIndex,this.state.intervalChoiceGroups[i].label.toLowerCase())},plusEL," ",buttonStr)));keyIndex+=1}}return React.createElement("div",{className:this.props.show?"":"invisible"},React.createElement("div",{className:"intervalButtonCont"},React.createElement("span",null,React.createElement("div",null,"Type"),React.createElement("div",{className:"button "+(this.state.modifyType==="change"?"buttonGood":""),onClick:this.onModeChange.bind(this,"change")},"change")),React.createElement("span",{className:"button "+(this.state.modifyType==="set"?"buttonGood":""),onClick:this.onModeChange.bind(this,"set")},"set"),toolbarConents),React.createElement("div",null,"Old interval: ",getPreciseIntervalStr(this.props.reviewInterval)),React.createElement("div",null,"New interval: ",getPreciseIntervalStr(this.getNewInterval())))}});var Review=React.createClass({displayName:"Review",getInitialState:function(){return{progressState:"frontSide"}},componentDidMount:function(){this.refs.flipButton.getDOMNode().focus()},componentDidUpdate:function(){this.refs.flipButton.getDOMNode().focus()},flip:function(){this.setState({progressState:"backSide"})},applyInterval:function(newInterval){this.props.applyInterval(newInterval);this.setState({progressState:"frontSide"})},getRenderedStr:function(str){var latexStringBuffer=[];var backStrNew=str.replace(/(\$.*?\$)/g,function(match,p1){latexStringBuffer.push(p1.slice(1,-1));return"$$"});return marked(backStrNew).replace(/\$\$/g,function(){return katex.renderToString(latexStringBuffer.shift())})},gotoEdit:function(){this.props.gotoEdit(this.props.nextInfoIndex)},render:function(){var flipButton=false;if(this.state.progressState==="frontSide")flipButton=React.createElement("div",{style:{textAlign:"center"}},React.createElement("button",{ref:"flipButton",className:"button buttonGood "+(this.state.progressState==="frontSide"?"":"invisible"),onClick:this.flip},"Show backside"));return React.createElement("div",{className:"Review Component"},React.createElement("div",null,React.createElement("span",{className:"button",onClick:this.gotoEdit},"Edit Info"),React.createElement("span",null,"Due count: "+this.props.dueCount)),React.createElement("div",{id:"reviewStage"},React.createElement("div",{className:"markdowned",dangerouslySetInnerHTML:{__html:this.getRenderedStr(this.props.frontStr)}}),React.createElement("div",{className:"markdowned "+(this.state.progressState==="backSide"?"":"invisible"),dangerouslySetInnerHTML:{__html:this.getRenderedStr(this.props.backStr)}})),flipButton,React.createElement(Intervaller,{show:this.state.progressState==="backSide",reviewInterval:this.props.reviewInterval,applyInterval:this.applyInterval,timeIntervalChoices:this.props.timeIntervalChoices}))}});var Views=React.createClass({displayName:"Views",onViewChange:function(type,event){this.props.onViewChange(type,event.target.value)},render:function(){var returnEls=[];returnEls.push(React.createElement("section",{key:1},React.createElement("h3",null,"Front"),React.createElement("textarea",{className:"sectionContent",value:this.props.view.front,rows:(this.props.view.front.match(/\n/g)||[]).length+1,onChange:this.onViewChange.bind(this,"front")})));returnEls.push(React.createElement("section",{key:2},React.createElement("h3",null,"Back"),React.createElement("textarea",{className:"sectionContent",value:this.props.view.back,rows:(this.props.view.back.match(/\n/g)||[]).length+1,onChange:this.onViewChange.bind(this,"back")})));returnEls.push(React.createElement("section",{key:3},React.createElement("h3",null,"Filter"),React.createElement("input",{className:"sectionContent",value:this.props.view.condition,onChange:this.onViewChange.bind(this,"condition")})));return React.createElement("div",null,returnEls)}});var client=new Dropbox.Client({key:"ob9346e5yc509q2"});client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:"https://leastaction.org/ginseng/dropbox_receiver.html"}));var App=React.createClass({displayName:"App",getInitialState:function(){return{infos:init_data.infos,infoTypes:init_data.infoTypes,ginseng_settings:init_data.settings,activeMode:"status",selectedInfoIndex:0,dropBoxStatus:"off",lastSaved:"never"}},clickNav:function(mode){this.setState({activeMode:mode})},authDB:function(){var thisApp=this;client.authenticate(function(error){if(error){thisApp.setState({dropBoxStatus:"ERROR"})}else{thisApp.setState({dropBoxStatus:"logged in!"})}})},saveDB:function(){var thisApp=this;var writeData={infos:this.state.infos,infoTypes:this.state.infoTypes,settings:this.state.ginseng_settings};client.writeFile("ginseng_data.txt",JSON.stringify(writeData,null,"	"),function(error,stat){if(error){console.log("error: "+error)}else{console.log("file saved with revision "+stat.versionTag);thisApp.setState({lastSaved:moment().format("LTS")})}})},loadDB:function(){var thisApp=this;client.readFile("ginseng_data.txt",function(error,data){if(error){return showError(error)}var js=JSON.parse(data);thisApp.setState({infos:js.infos,infoTypes:js.infoTypes,ginseng_settings:js.settings})})},onRowSelect:function(index_selected){this.setState({selectedInfoIndex:index_selected,activeMode:"edit"})},gotoEdit:function(infoIndex){this.setState({selectedInfoIndex:infoIndex,activeMode:"edit"})},onInfoEdit:function(newInfo){var newInfos=this.state.infos.slice();newInfos[this.state.selectedInfoIndex]=newInfo;this.setState({infos:newInfos,activeMode:"browse"})},onInfoDelete:function(){var newInfos=JSON.parse(JSON.stringify(this.state.infos));console.log("ondelete, this.state.selectedInfoIndex: "+this.state.selectedInfoIndex);newInfos.splice(this.state.selectedInfoIndex,1);this.setState({infos:newInfos,activeMode:"browse"})},addInfo:function(newInfo){var newInfo_copy=JSON.parse(JSON.stringify(newInfo));var newInfos=JSON.parse(JSON.stringify(this.state.infos));newInfos.push(newInfo_copy);var new_settings=JSON.parse(JSON.stringify(this.state.ginseng_settings));this.setState({infos:newInfos,ginseng_settings:new_settings,activeMode:"browse"})},onTypesEdit:function(newTypes,changes){var newTypes_copy=JSON.parse(JSON.stringify(newTypes));var new_infos=JSON.parse(JSON.stringify(this.state.infos));for(var infoIdx=0;infoIdx<new_infos.length;++infoIdx){for(var resizeIdx=0;resizeIdx<changes.typeResizes.length;++resizeIdx){if(new_infos[infoIdx].typeID===changes.typeResizes[resizeIdx].id){var fieldNameIndex=changes.typeResizes[resizeIdx].fieldNameIndex;if(fieldNameIndex===-1){new_infos[infoIdx].fields.push("")}else{new_infos[infoIdx].fields.splice(fieldNameIndex,1)}}}}this.setState({infoTypes:newTypes_copy,infos:new_infos,activeMode:"browse"})},applyInterval:function(infoIndex,reviewKey,newInterval){var newInfos=JSON.parse(JSON.stringify(this.state.infos));newInfos[infoIndex].reviews[reviewKey].push({reviewTime:moment().format(),dueTime:moment().add(moment.duration(newInterval)).format()});this.setState({infos:newInfos})},filterInfo:function(filterStr,info){if(filterStr===""){return true}var filterStrNew=filterStr.replace(/ /g,"");var filters=filterStrNew.split(",");for(var i=0;i<filters.length;++i){if(filters[i]===""){console.log("   empty?")}else if(filters[i]==="tag:reverse"){if(info.tags.indexOf("reverse")===-1){return false}}else{console.log("other filter, eek")}}return true},render:function(){var usedTags=[];for(var i=0;i<this.state.infos.length;++i){for(var j=0;j<this.state.infos[i].tags.length;++j){if(usedTags.indexOf(this.state.infos[i].tags[j])===-1){usedTags.push(this.state.infos[i].tags[j])}}}var typeNames={};for(var key in this.state.infoTypes){typeNames[key]=this.state.infoTypes[key].name}var compEdit=React.createElement("div",null);if(["new","edit"].indexOf(this.state.activeMode)!==-1){var editInfo,onSave,onDelete,saveButtonStr;if(this.state.activeMode=="new"){editInfo={typeID:this.state.infos[this.state.infos.length-1].typeID};onSave=this.addInfo;onDelete=false;saveButtonStr="add"}else{editInfo=this.state.infos[this.state.selectedInfoIndex];onSave=this.onInfoEdit;onDelete=this.onInfoDelete;saveButtonStr="save"}compEdit=React.createElement(InfoEdit,{typeNames:typeNames,types:this.state.infoTypes,info:editInfo,saveButtonStr:saveButtonStr,usedTags:usedTags,onSave:onSave,cancelEdit:this.clickNav.bind(this,"browse"),onDelete:onDelete})}var compBrowser=React.createElement("div",null);if(this.state.activeMode==="browse"){compBrowser=React.createElement(InfoBrowser,{infos:this.state.infos,typeNames:typeNames,onRowSelect:this.onRowSelect,onNew:this.clickNav.bind(this,"new"),selections:this.state.ginseng_selections})}var comp_review=React.createElement("div",null);if(this.state.activeMode==="review"){var thisApp=this;(function(){var dueItems=[];var infoIndex,info;var filteredInfos=thisApp.state.infos;var urgency;for(infoIndex=0;infoIndex<filteredInfos.length;++infoIndex){info=filteredInfos[infoIndex];for(var reviewKey in info.reviews){if(!thisApp.filterInfo(thisApp.state.infoTypes[info.typeID].views[reviewKey].condition,info)){console.log("out due filter: "+info.fields[0].slice(0,10)+", reviewKey: "+reviewKey);continue}if(info.reviews[reviewKey].length>0){var lastDueTimeStr=info.reviews[reviewKey][info.reviews[reviewKey].length-1].dueTime;var lastReviewTimeStr=info.reviews[reviewKey][info.reviews[reviewKey].length-1].reviewTime;var plannedIntervalMs=moment(lastDueTimeStr).diff(moment(lastReviewTimeStr));var actualIntervalMs=moment().diff(moment(lastReviewTimeStr));urgency=actualIntervalMs/plannedIntervalMs;if(urgency>=1){console.log("in due urgency: "+info.fields[0].slice(0,10)+", reviewKey: "+reviewKey+", urgency: "+urgency);dueItems.push([actualIntervalMs,infoIndex,reviewKey,urgency])}else{console.log("out due urgency: "+info.fields[0].slice(0,10)+", reviewKey: "+reviewKey+", urgency: "+urgency)}}else{dueItems.push([0,infoIndex,reviewKey,1.1]);console.log("in because new: "+info.fields[0].slice(0,10)+", reviewKey: "+reviewKey)}}}var dueCount=dueItems.length;if(dueCount>0){var winnerActualInterval=0;var winnerUrgency=0;var nextInfoIndex=0;var nextReviewID=0;for(var index=0;index<dueItems.length;++index){if(dueItems[index][3]>=winnerUrgency){winnerActualInterval=dueItems[index][0];nextInfoIndex=dueItems[index][1];nextReviewID=dueItems[index][2];winnerUrgency=dueItems[index][3]}}var nextTypeID=thisApp.state.infos[nextInfoIndex].typeID;comp_review=React.createElement(Review,{applyInterval:thisApp.applyInterval.bind(thisApp,nextInfoIndex,nextReviewID),frontStr:thisApp.state.infoTypes[nextTypeID].views[nextReviewID].front.replace(/{(\w*)}/g,function(match,p1){return thisApp.state.infos[nextInfoIndex].fields[thisApp.state.infoTypes[nextTypeID].fieldNames.indexOf(p1)]}),backStr:thisApp.state.infoTypes[nextTypeID].views[nextReviewID].back.replace(/{(\w*)}/g,function(match,p1){return thisApp.state.infos[nextInfoIndex].fields[thisApp.state.infoTypes[nextTypeID].fieldNames.indexOf(p1)]}),dueCount:dueCount,reviewInterval:winnerActualInterval,timeIntervalChoices:thisApp.state.ginseng_settings.timeIntervalChoices,nextInfoIndex:nextInfoIndex,gotoEdit:thisApp.gotoEdit})}})()}var compTypes=false;if(this.state.activeMode=="types"){compTypes=React.createElement(InfoTypes,{infoTypes:this.state.infoTypes,cancelEdit:this.clickNav.bind(this,"browse"),onSave:this.onTypesEdit})}return React.createElement("div",{className:"app"},React.createElement("div",{className:"navBar"},React.createElement("div",{className:this.state.activeMode=="status"?"active":"inactive",onClick:this.clickNav.bind(this,"status")},"Status"),React.createElement("div",{className:this.state.activeMode==="browse"?"active":"inactive",onClick:this.clickNav.bind(this,"browse")},"Infos"),React.createElement("div",{className:this.state.activeMode=="types"?"active":"inactive",onClick:this.clickNav.bind(this,"types")},"Types"),React.createElement("div",{className:this.state.activeMode=="review"?"active":"inactive",onClick:this.clickNav.bind(this,"review")},"Review")),React.createElement(Status,{show:this.state.activeMode=="status",infoCount:this.state.infos.length,dropBoxStatus:this.state.dropBoxStatus,onDBAuth:this.authDB,onDbSave:this.saveDB,lastSaved:this.state.lastSaved,onDbLoad:this.loadDB}),compEdit,compBrowser,compTypes,comp_review)}});var Status=React.createClass({displayName:"Status",render:function(){if(this.props.show){return React.createElement("div",{className:"Status Component"},React.createElement("div",null,"Infos loaded: ",this.props.infoCount),React.createElement("div",null,"Dropbox Status: ",this.props.dropBoxStatus),React.createElement("div",null,"Last save: ",this.props.lastSaved," (local time)"),React.createElement("div",null),React.createElement("div",{className:"flexContHoriz"},React.createElement("span",{className:"button buttonGood "+(this.props.dropBoxStatus==="logged in!"?"disabled":""),onClick:this.props.onDBAuth},"auth Dropbox"),React.createElement("span",{className:"button "+(this.props.dropBoxStatus==="logged in!"?"":"invisible"),onClick:this.props.onDbLoad},"load from Dropbox"),React.createElement("span",{className:"button "+(this.props.dropBoxStatus==="logged in!"?"":"invisible"),onClick:this.props.onDbSave},"save to Dropbox")))}else{return React.createElement("div",{className:"Status Component"})}}});React.render(React.createElement(App,null),document.getElementById("content"));