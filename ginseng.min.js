"use strict";function getPreciseIntervalStr(t){var e=moment.duration(t);return e.asMinutes()<=1?"<1 min":e.asYears()>=1?Math.round(10*e.asYears())/10+" years":e.asMonths()>=1?Math.round(10*e.asMonths())/10+" months":e.asWeeks()>=1?Math.round(10*e.asWeeks())/10+" weeks":e.asDays()>=1?Math.round(10*e.asDays())/10+" days":e.asHours()>=1?Math.round(10*e.asHours())/10+" hours":e.asMinutes()>=1?Math.round(10*e.asMinutes())/10+" minutes":void 0}function getShortPreciseIntervalStr(t){var e=moment.duration(t);return e.asMinutes()<=1?"<1 min":e.asYears()>=1?Math.round(10*e.asYears())/10+" y":e.asMonths()>=1?Math.round(10*e.asMonths())/10+" m":e.asWeeks()>=1?Math.round(10*e.asWeeks())/10+" w":e.asDays()>=1?Math.round(10*e.asDays())/10+" d":e.asHours()>=1?Math.round(10*e.asHours())/10+" h":e.asMinutes()>=1?Math.round(10*e.asMinutes())/10+" m":void 0}var InfoBrowser=React.createClass({displayName:"InfoBrowser",getInitialState:function(){return{filterText:"",sortOrder:"1"}},onFilterChange:function(e){this.setState({filterText:e.target.value})},changeSortOrder:function(e){var t=e;this.state.sortOrder===e&&(t+="r"),this.setState({sortOrder:t})},render:function(){console.log("render browse");for(var n,a,u=this,t=this.props.infos.sort(function(e,t){switch(u.state.sortOrder){case"1":return e.entries[0].localeCompare(t.entries[0]);case"1r":return-e.entries[0].localeCompare(t.entries[0]);case"2":return e.entries[1].localeCompare(t.entries[1]);case"2r":return-e.entries[1].localeCompare(t.entries[1]);case"age":return moment(e.creationDate).isBefore(t.creationDate)?1:-1;case"ager":return moment(e.creationDate).isBefore(t.creationDate)?-1:1}}),i=0,d=[],o=0;o<t.length;++o)n=moment().diff(moment(t[o].creationDate)),n>i&&(i=n);for(var e=0;e<t.length;++e)if(n=moment().diff(moment(t[e].creationDate)),-1!==t[e].entries[0].toLowerCase().indexOf(this.state.filterText.toLowerCase())||-1!==t[e].entries[1].toLowerCase().indexOf(this.state.filterText.toLowerCase())){var m=[];a=[t[e].entries[0],t[e].entries[1],this.props.types[t[e].typeID].name,t[e].tags.join(", "),getShortPreciseIntervalStr(n)];for(var s=0;s<a.length;++s){var p,h=2===s?5:15;p=a[s].length>h?a[s].slice(0,h)+"...":a[s],m.push(4==s?React.createElement("td",{key:s},React.createElement("div",{style:{position:"absolute"}},p),React.createElement("div",{style:{height:"1em",background:"#E0E0E0",width:n/i*100+"%"}})):React.createElement("td",{key:s},p))}d.push(React.createElement("tr",{key:e,onClick:this.props.onRowSelect.bind(null,e)},m))}var l="1st",c="2nd",r="Age";switch(this.state.sortOrder){case"1":l+="↓";break;case"1r":l+="↑";break;case"2":c+="↓";break;case"2r":c+="↑";break;case"age":r+="↓";break;case"ager":r+="↑"}return React.createElement("div",{className:"InfoBrowser Component"},React.createElement("div",{className:"browseControls"},React.createElement("input",{type:"text",placeholder:"Quick filter...",value:this.state.filterText,onChange:this.onFilterChange}),React.createElement("button",{className:"button buttonGood",onClick:this.props.onNew},"New info")),React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{onClick:this.changeSortOrder.bind(this,"1")},l),React.createElement("th",{onClick:this.changeSortOrder.bind(this,"2")},c),React.createElement("th",null,"Type"),React.createElement("th",null,"Tags"),React.createElement("th",{onClick:this.changeSortOrder.bind(this,"age")},r))),React.createElement("tbody",null,d)))}}),InfoEdit=React.createClass({displayName:"InfoEdit",getInitialState:function(){return{info:JSON.parse(JSON.stringify(this.props.info)),previewID:!1,scrollHeights:{}}},onTypeChange:function(s){var e=JSON.parse(JSON.stringify(this.state.info));e.typeID=s;var n=this.props.types[s].entryNames.length,t=n-this.state.info.entries.length;if(t>0)for(var a=0;t>a;a++)e.entries.push("");else 0>t&&(e.entries=e.entries.slice(0,n));this.setState({info:e})},onTagsEdit:function(e){var t=JSON.parse(JSON.stringify(this.state.info));t.tags=""===e.target.value?[]:e.target.value.replace(/ /g,"").split(","),this.setState({info:t})},addUsedTag:function(t){var e=JSON.parse(JSON.stringify(this.state.info));e.tags.push(t),this.setState({info:e})},setPreview:function(e){this.setState({previewID:e})},onEntryEdit:function(e){console.log("name: "+e.target.name+", value: "+e.target.value);var t=JSON.parse(JSON.stringify(this.state.info)),s=JSON.parse(JSON.stringify(this.state.scrollHeights));s[e.target.name]=this.refs[e.target.name].getDOMNode().scrollHeight,t.entries[e.target.name]=e.target.value,this.setState({info:t,scrollHeights:s})},render:function(){var a;a="info"in this.props?React.createElement("section",null,React.createElement("h3",null,"Info Type"),React.createElement("span",{className:"sectionContent"},this.props.types[this.state.info.typeID].name)):React.createElement("section",null,React.createElement("h3",null,"Info Type"),React.createElement(ITypeSwitcher,{className:"sectionContent",types:this.props.types,selectedTypeID:this.state.info.typeID,onTypeChange:this.onTypeChange}));for(var i=[],e=0;e<this.state.info.entries.length;++e){var o={overflow:"hidden"};e in this.state.scrollHeights&&(o={overflow:"hidden",height:this.state.scrollHeights[e]-4+"px"}),i.push(React.createElement("textarea",{key:e,value:this.state.info.entries[e],placeholder:this.props.types[this.state.info.typeID].entryNames[e],className:"sectionContent",style:o,name:e,ref:e}))}for(var r,n=[],t=0;t<this.props.usedTags.length;++t)-1===this.state.info.tags.indexOf(this.props.usedTags[t])&&(r=0===n.length?"":", ",n.push(React.createElement("a",{key:t,onClick:this.addUsedTag.bind(this,this.props.usedTags[t]),href:"#"},r+this.props.usedTags[t])));var c=[React.createElement("button",{key:"none",className:"flexElemContHoriz"+(this.state.previewID?"":" buttonGood"),onClick:this.setPreview.bind(this,!1)},"None")];for(var s in this.props.types[this.state.info.typeID].templates)c.push(React.createElement("button",{key:s,className:"flexElemContHoriz"+(this.state.previewID===s?" buttonGood":""),onClick:this.setPreview.bind(this,s)},"Templ. "+s));return React.createElement("div",{className:"InfoEdit Component"},a,React.createElement("section",null,React.createElement("h3",null,"Entries"),React.createElement("form",{onChange:this.onEntryEdit},i)),React.createElement("section",null,React.createElement("h3",null,"Tags"),React.createElement("textarea",{className:"sectionContent",rows:1,type:"text",value:this.state.info.tags.join(", "),onChange:this.onTagsEdit}),React.createElement("div",{className:"sectionContent"},"used: ",n)),React.createElement("section",null,React.createElement("h3",null,"Preview"),React.createElement("div",{className:"sectionContent tabContainer"},c)),this.state.previewID&&React.createElement(ReviewDisplay,{type:this.props.types[this.state.info.typeID],viewID:this.state.previewID,info:this.state.info,progressState:"backSide"}),React.createElement("div",{className:"flexContHoriz"},React.createElement("button",{disabled:JSON.stringify(this.props.info)===JSON.stringify(this.state.info),className:"buttonGood",onClick:this.props.onSave.bind(null,this.state.info)},this.props.onDelete?"save":"add"),React.createElement("button",{onClick:this.props.cancelEdit},"Cancel"),this.props.onDelete&&React.createElement("button",{className:"buttonDanger",onClick:this.props.onDelete},"Delete")))}}),Popup=React.createClass({displayName:"Popup",render:function(){return React.createElement("div",{className:"popup"},React.createElement("p",null,this.props.text),this.props.buttonContainer)}}),ITypeSwitcher=React.createClass({displayName:"ITypeSwitcher",onTypeChange:function(e){this.props.onTypeChange(e)},render:function(){var t=[];for(var e in this.props.types)t.push(React.createElement("button",{key:e,className:"button"+(this.props.selectedTypeID===e?" buttonGood":""),onClick:this.onTypeChange.bind(this,e)},this.props.types[e].name));return this.props.onAddType&&t.push(React.createElement("button",{className:"button",key:"new",onClick:this.props.onAddType},"New..")),React.createElement("div",{className:"sectionContent wrap"},t)}}),Intervaller=React.createClass({displayName:"Intervaller",getInitialState:function(){return{modifyType:"change",changeType:"minutes",modifyAmount:10,activeKeyIndex:0}},onModeChange:function(e){if(e!==this.state.modifyType){var t=this.state.activeKeyIndex;"set"===e&&"percent"===this.state.changeType&&(t=0),this.setState({modifyType:e,activeKeyIndex:t})}},componentWillMount:function(){console.log("intervaller mount")},getNewInterval:function(){var e;return"change"===this.state.modifyType?"percent"===this.state.changeType?(e=this.props.reviewInterval*this.state.modifyAmount/100,e+this.props.reviewInterval):(e=moment.duration(this.state.modifyAmount,this.state.changeType.toLowerCase()).asMilliseconds(),this.props.reviewInterval+e):"set"===this.state.modifyType?moment.duration(this.state.modifyAmount,this.state.changeType.toLowerCase()).asMilliseconds():void 0},onIntervalChoice:function(t,e,s){this.state.activeKeyIndex===e&&this.props.applyInterval(this.getNewInterval()),this.setState({activeKeyIndex:e,changeType:s,modifyAmount:t})},render:function(){console.log("render intervaller");var s,o=React.addons.classSet,a=[],t=0;for(var e in this.props.timeIntervalChoices)for(var n=0;n<this.props.timeIntervalChoices[e].length;++n){var r=o({unselectable:!0,intervalMinutes:"Minutes"===e,intervalHours:"Hours"===e,intervalDays:"Days"===e,intervalWeeks:"Weeks"===e,intervalMonths:"Months"===e,intervalPercent:"Percent"===e,buttonSelected:t===this.state.activeKeyIndex,invisible:"Percent"===e&&"set"===this.state.modifyType}),c=React.createElement("span",{className:"change"===this.state.modifyType?"":"invisible"},"+");s=this.props.timeIntervalChoices[e][n];var i=s;i+="Percent"===e?"%":e.slice(0,1).toLowerCase(),a.push(React.createElement("button",{key:t,className:r,onClick:this.onIntervalChoice.bind(this,s,t,e.toLowerCase())},c," ",i)),t+=1}return React.createElement("div",{className:this.props.show?"":"invisible"},React.createElement("button",{className:" "+("change"===this.state.modifyType?"buttonGood":""),onClick:this.onModeChange.bind(this,"change")},"change"),React.createElement("button",{className:" "+("set"===this.state.modifyType?"buttonGood":""),onClick:this.onModeChange.bind(this,"set")},"set"),React.createElement("div",{className:"intervalButtonCont"},a),React.createElement("div",null,"Old interval: ",getPreciseIntervalStr(this.props.reviewInterval)),React.createElement("div",null,"New interval: ",getPreciseIntervalStr(this.getNewInterval())),React.createElement("div",null,"Due on: ",moment().add(moment.duration(this.getNewInterval())).format("dddd, YYYY-MM-DD, HH:mm")))}}),Review=React.createClass({displayName:"Review",getInitialState:function(){return{progressState:"frontSide"}},componentDidMount:function(){"flipButton"in this.refs&&this.refs.flipButton.getDOMNode().focus()},componentDidUpdate:function(){"frontSide"===this.state.progressState&&"flipButton"in this.refs&&this.refs.flipButton.getDOMNode().focus()},flip:function(){this.setState({progressState:"backSide"})},applyInterval:function(e,t,s){this.props.applyInterval(e,t,s),this.setState({progressState:"frontSide"})},filterInfo:function(s,n){if(""===s)return!0;for(var a=s.replace(/ /g,""),t=a.split(","),e=0;e<t.length;++e)if(""===t[e])console.log("   empty?");else if("tag:reverse"===t[e]){if(-1===n.tags.indexOf("reverse"))return!1}else console.log("other filter, eek");return!0},render:function(){var r=!1;"frontSide"===this.state.progressState&&(r=React.createElement("div",{style:{textAlign:"center"}},React.createElement("button",{tabIndex:"1",ref:"flipButton",className:"button buttonGood "+("frontSide"===this.state.progressState?"":"invisible"),onClick:this.flip},"Show backside")));for(var a,i,o=0,e={urgency:1,infoIndex:0,info:!1,viewID:0,realInterval:0},n=0;n<this.props.infos.length;++n){var t=this.props.infos[n];for(var s in t.reviews)if(this.filterInfo(this.props.types[t.typeID].templates[s].condition,t)){if(t.reviews[s].length>0){var l=t.reviews[s][t.reviews[s].length-1].dueTime,c=t.reviews[s][t.reviews[s].length-1].reviewTime,p=moment(l).diff(moment(c));i=moment().diff(moment(c)),a=i/p}else a=1.1,i=0;a>=1&&o++,a>e.urgency&&(e.urgency=a,e.info=this.props.infos[n],e.infoIndex=n,e.viewID=s,e.realInterval=i)}}return o>0?React.createElement("div",{className:"Component"},React.createElement("div",null,React.createElement("button",{className:"button",tabIndex:"2",onClick:this.props.gotoEdit.bind(null,e.infoIndex)},"Edit Info"),React.createElement("span",null,"Due count: "+o)),React.createElement(ReviewDisplay,{type:this.props.types[e.info.typeID],viewID:e.viewID,info:e.info,progressState:this.state.progressState}),r,React.createElement(Intervaller,{show:"backSide"===this.state.progressState,reviewInterval:e.realInterval,applyInterval:this.applyInterval.bind(this,e.infoIndex,e.viewID),timeIntervalChoices:this.props.timeIntervalChoices})):React.createElement("div",{className:"Component",style:{textAlign:"center"}},"No due reviews")}}),ReviewDisplay=React.createClass({displayName:"ReviewDisplay",renderMarkdown:function(t){var e=[],s=t.replace(/(\$.*?\$)/g,function(s,t){return e.push(t.slice(1,-1)),"$$"});return marked.setOptions({breaks:!0}),marked(s).replace(/\$\$/g,function(){try{return katex.renderToString(e.shift())}catch(e){return console.log("Error: "+e.message),"ERROR."}})},render:function(){var e=this,t=this.props.type.templates[this.props.viewID].front.replace(/{(\w*)}/g,function(s,t){return e.props.info.entries[e.props.type.entryNames.indexOf(t)]}),s=this.props.type.templates[this.props.viewID].back.replace(/{(\w*)}/g,function(s,t){return e.props.info.entries[e.props.type.entryNames.indexOf(t)]});return React.createElement("div",{id:"reviewStage"},React.createElement("div",{className:"markdowned",dangerouslySetInnerHTML:{__html:this.renderMarkdown(t)}}),React.createElement("div",{className:"markdowned "+("backSide"===this.props.progressState?"":"invisible"),dangerouslySetInnerHTML:{__html:this.renderMarkdown(s)}}))}}),InfoTypes=React.createClass({displayName:"InfoTypes",getInitialState:function(){for(var e=0;!(e in this.props.types);)e++;return this.props.selectedTypeID&&(e=this.props.selectedTypeID),{selectedTypeID:e.toString(),types:this.props.types,changes:{renames:"",typeResizes:[]},mode:"main"}},onFieldNameEdit:function(s,n){var e=JSON.parse(JSON.stringify(this.state.types));e[this.state.selectedTypeID].entryNames[s]=n.target.value;var t=JSON.parse(JSON.stringify(this.state.changes));t.renames="renamed",this.setState({types:e,changes:t})},selectType:function(e){this.setState({selectedTypeID:e,mode:"main"})},onNameEdit:function(s){var e=JSON.parse(JSON.stringify(this.state.types));e[this.state.selectedTypeID].name=s.target.value;var t=JSON.parse(JSON.stringify(this.state.changes));t.renames="renamed",this.setState({types:e,changes:t})},onFieldsResize:function(e){var t=JSON.parse(JSON.stringify(this.state.types));"add"===e?t[this.state.selectedTypeID].entryNames.push(""):t[this.state.selectedTypeID].entryNames.splice(e,1);var s=JSON.parse(JSON.stringify(this.state.changes));s.typeResizes.push({id:this.state.selectedTypeID,fieldNameIndex:e}),this.setState({types:t,changes:s})},componentDidUpdate:function(){"New info type"===this.state.types[this.state.selectedTypeID].name&&this.refs.nameRef.getDOMNode().focus()},onAddType:function(){var t=JSON.parse(JSON.stringify(this.state.types)),e="0";for(var s in t)parseInt(s,10)>parseInt(e,10)&&(e=s);e=(parseInt(e,10)+1).toString(),t[e]={name:"New info type",entryNames:["first field","second field"],templates:{0:{front:"{front}",back:"{back}",condition:""},1:{front:"{back}",back:"{front}",condition:"tag: reverse"}}},this.setState({types:t,selectedTypeID:e})},setMode:function(e){this.setState({mode:e})},onViewChange:function(t,s){var e=JSON.parse(JSON.stringify(this.state.types));e[this.state.selectedTypeID].templates[this.state.mode][t]=s,this.setState({types:e})},render:function(){var e=this;console.log("render types");var s,t=this.state.types[this.state.selectedTypeID];s="main"!==this.state.mode?React.createElement(TemplateDetails,{view:t.templates[this.state.mode],onViewChange:this.onViewChange}):[React.createElement("section",{key:0},React.createElement("h3",null,"Name"),React.createElement("input",{className:"sectionContent",type:"text",ref:"nameRef",id:"typeName",value:t.name,onChange:this.onNameEdit})),React.createElement("section",{key:1},React.createElement("h3",null,"Entries"),t.entryNames.map(function(n,s){return React.createElement("div",{key:s,className:"sectionContent"},React.createElement("input",{className:"sectionContentEl",value:n,onChange:e.onFieldNameEdit.bind(e,s)}),React.createElement("button",{className:"buttonDanger microbutton sectionContentElFixed"+(t.entryNames.length<=2?" invisible":""),onClick:e.onFieldsResize.bind(e,s)},"✖"))}),React.createElement("div",{className:"sectionContent"},React.createElement("button",{className:"buttonGood",onClick:this.onFieldsResize.bind(this,"add")},"Add entry")))];var n=JSON.stringify(this.props.types)!==JSON.stringify(this.state.types);return React.createElement("div",{className:"Component"},React.createElement("section",null,React.createElement("h3",null,"Info Type"),React.createElement(ITypeSwitcher,{className:"sectionContent",types:this.state.types,selectedTypeID:this.state.selectedTypeID,onTypeChange:this.selectType,onAddType:this.onAddType})),React.createElement("section",{className:"sectionContent tabContainer"},React.createElement("button",{className:"main"===this.state.mode?"buttonGood":"",onClick:this.setMode.bind(this,"main")},"Type"),Object.keys(t.templates).map(function(t){return React.createElement("button",{key:t,className:"flexElemContHoriz button "+(e.state.mode===t?"buttonGood":""),onClick:e.setMode.bind(e,t)},"Template "+t)})),s,React.createElement("section",{className:"sectionContent flexContHoriz"},React.createElement("button",{disabled:!n,className:"flexElemContHoriz buttonGood",onClick:this.props.onSave.bind(null,this.state.types,this.state.changes)},"Save"),React.createElement("button",{className:"flexElemContHoriz",onClick:this.props.cancelEdit},"Cancel")))}}),client=new Dropbox.Client({key:"ob9346e5yc509q2"});client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:"https://leastaction.org/ginseng/dropbox_receiver.html"}));var App=React.createClass({displayName:"App",getInitialState:function(){return{infos:init_data.infos,infoTypes:init_data.infoTypes,ginseng_settings:init_data.settings,meta:init_data.meta,activeMode:"status",selectedTypeID:!1,selectedInfoIndex:!1,conversionNote:!1,dropBoxStatus:"initial",lastLoadedStr:"never"}},clickNav:function(e){this.setState({activeMode:e})},authDB:function(){this.setState({dropBoxStatus:"logging in..."});var e=this;client.authenticate(function(t){e.setState(t?{dropBoxStatus:"ERROR"}:{dropBoxStatus:"loggedIn"})})},saveDB:function(){this.setState({dropBoxStatus:"saving"});var i=this,t=JSON.parse(JSON.stringify(this.state.meta));t.lastSaved=moment().format();for(var s=JSON.parse(JSON.stringify(this.state.infos)),n=0;n<s.length;n++){var e=s[n];for(var a in e.reviews)e.reviews[a].length>this.state.ginseng_settings.reviewHistoryLength&&(e.reviews[a]=e.reviews[a].slice(-2))}var o={infos:s,infoTypes:this.state.infoTypes,settings:this.state.ginseng_settings,meta:t};client.writeFile("ginseng_data.txt",JSON.stringify(o,null,"	"),function(e){e&&console.log("error: "+e),i.setState({meta:t,dropBoxStatus:"loggedIn",conversionNote:!1})})},loadJsonData:function(e){var t={infos:e.infos,infoTypes:e.infoTypes,ginseng_settings:e.settings};return"meta"in e?(this.setState({conversionNote:!1}),t.meta=e.meta):(this.setState({conversionNote:"old data format from before 2014-12-17. Converted!"}),t.meta={dataFormatVersion:"2014-12-17",lastSaved:"never"}),t},loadDB:function(){this.setState({dropBoxStatus:"loading"});var e=this;client.readFile("ginseng_data.txt",function(s,n){s&&console.log("ERROR: "+s);var t=e.loadJsonData(JSON.parse(n));e.setState({infos:t.infos,infoTypes:t.infoTypes,ginseng_settings:t.ginseng_settings,meta:t.meta,lastLoadedStr:moment().format(),dropBoxStatus:"loggedIn"})})},gotoEdit:function(e){this.setState({selectedInfoIndex:e,activeMode:"edit"})},onInfoEdit:function(t){var e=this.state.infos.slice();"edit"===this.state.activeMode?e[this.state.selectedInfoIndex]=t:e.push(t),this.setState({infos:e,activeMode:"browse"})},onInfoDelete:function(){var e=JSON.parse(JSON.stringify(this.state.infos));console.log("ondelete, this.state.selectedInfoIndex: "+this.state.selectedInfoIndex),e.splice(this.state.selectedInfoIndex,1),this.setState({infos:e,activeMode:"browse"})},onTypesEdit:function(i,n){for(var o=JSON.parse(JSON.stringify(i)),e=JSON.parse(JSON.stringify(this.state.infos)),t=0;t<e.length;++t)for(var s=0;s<n.typeResizes.length;++s)if(e[t].typeID===n.typeResizes[s].id){var a=n.typeResizes[s].fieldNameIndex;"add"===a?e[t].entries.push(""):e[t].entries.splice(a,1)}this.setState({infoTypes:o,infos:e,activeMode:"browse"})},applyInterval:function(t,s,n){var e=JSON.parse(JSON.stringify(this.state.infos));e[t].reviews[s].push({reviewTime:moment().format(),dueTime:moment().add(moment.duration(n)).format()}),this.setState({infos:e})},getNewInfo:function(){for(var e="0";!(e in this.state.infoTypes);)e=(parseInt(e,10)+1).toString();var t=[],s={};for(i=0;i<this.state.infoTypes[e].entryNames.length;++i)t.push(""),s[i]=[];return{typeID:e,entries:t,reviews:s,tags:[],creationDate:moment().format()}},render:function(){console.log("render main");for(var s=[],e=0;e<this.state.infos.length;++e)for(var t=0;t<this.state.infos[e].tags.length;++t)-1===s.indexOf(this.state.infos[e].tags[t])&&s.push(this.state.infos[e].tags[t]);return React.createElement("div",{className:"app"},React.createElement("div",{className:"navBar unselectable"},React.createElement("div",{className:"status"==this.state.activeMode?"active":"inactive",onClick:this.clickNav.bind(this,"status")},"Status"),React.createElement("div",{className:-1!==["browse","new","edit"].indexOf(this.state.activeMode)?"active":"inactive",onClick:this.clickNav.bind(this,"browse")},"Infos"),React.createElement("div",{className:"types"==this.state.activeMode?"active":"inactive",onClick:this.clickNav.bind(this,"types")},"Types"),React.createElement("div",{className:"review"==this.state.activeMode?"active":"inactive",onClick:this.clickNav.bind(this,"review")},"Review")),"status"===this.state.activeMode&&React.createElement(Status,{infoCount:this.state.infos.length,dropBoxStatus:this.state.dropBoxStatus,onDBAuth:this.authDB,onDbSave:this.saveDB,meta:this.state.meta,lastLoadedStr:this.state.lastLoadedStr,onDbLoad:this.loadDB,conversionNote:this.state.conversionNote}),-1!==["new","edit"].indexOf(this.state.activeMode)&&React.createElement(InfoEdit,{info:"new"===this.state.activeMode?this.getNewInfo():this.state.infos[this.state.selectedInfoIndex],onDelete:"edit"===this.state.activeMode?this.onInfoDelete:!1,types:this.state.infoTypes,usedTags:s,onSave:this.onInfoEdit,cancelEdit:this.clickNav.bind(this,"browse")}),"browse"===this.state.activeMode&&React.createElement(InfoBrowser,{infos:this.state.infos,types:this.state.infoTypes,onRowSelect:this.gotoEdit,onNew:this.clickNav.bind(this,"new"),selections:this.state.ginseng_selections}),"types"===this.state.activeMode&&React.createElement(InfoTypes,{types:this.state.infoTypes,cancelEdit:this.clickNav.bind(this,"browse"),onSave:this.onTypesEdit,selectedTypeID:this.state.selectedTypeID}),"review"===this.state.activeMode&&React.createElement(Review,{infos:this.state.infos,types:this.state.infoTypes,applyInterval:this.applyInterval,timeIntervalChoices:this.state.ginseng_settings.timeIntervalChoices,gotoEdit:this.gotoEdit}))}}),Status=React.createClass({displayName:"Status",getInitialState:function(){return{showOverwriteWarning:!1}},componentWillReceiveProps:function(){this.setState({showOverwriteWarning:!1})},onSaveClick:function(){"never"===this.props.lastLoadedStr?this.setState({showOverwriteWarning:!0}):this.props.onDbSave()},onCancelOverwrite:function(){this.setState({showOverwriteWarning:!1})},render:function(){var s=!1;this.props.conversionNote&&(s=React.createElement("div",null,this.props.conversionNote));var e=this.props.meta.lastSaved,t=this.props.lastLoadedStr;"never"!==this.props.meta.lastSaved&&(e=moment(this.props.meta.lastSaved).fromNow()),"never"!==this.props.lastLoadedStr&&(t=moment(this.props.lastLoadedStr).fromNow()),"loading"===this.props.dropBoxStatus&&(e="...",t="..."),"saving"===this.props.dropBoxStatus&&(e="...");var a=5;console.log("A: "+a);var n=!1;if(this.state.showOverwriteWarning){var i=React.createElement("div",{className:"flexContHoriz"},React.createElement("button",{onClick:this.props.onDbSave,className:"button buttonGood"},"Yes"),React.createElement("button",{onClick:this.onCancelOverwrite,className:"button buttonGood"},"Oh god no"));n=React.createElement(Popup,{text:"You're about to save to your Dropbox without loading first. This will overwrite previous data in your Dropbox! Continue?",buttonContainer:i})}return React.createElement("div",{className:"Status Component"},n,React.createElement("div",null,"Infos loaded: ","loading"===this.props.dropBoxStatus?"loading":this.props.infoCount),React.createElement("div",null,"Dropbox Status: ",this.props.dropBoxStatus),React.createElement("div",null,"Last save: "+e),React.createElement("div",null,"Last load: "+t),s,React.createElement("div",{className:"flexContHoriz"},React.createElement("button",{disabled:"initial"!==this.props.dropBoxStatus,className:"buttonGood",onClick:this.props.onDBAuth},"Log into Dropbox"),React.createElement("button",{disabled:"loggedIn"!==this.props.dropBoxStatus,onClick:this.props.onDbLoad},"Load from Dropbox"),React.createElement("button",{disabled:"loggedIn"!==this.props.dropBoxStatus,onClick:this.onSaveClick},"Save to Dropbox")))}});React.render(React.createElement(App,null),document.getElementById("content"));var TemplateDetails=React.createClass({displayName:"TemplateDetails",onViewChange:function(e,t){this.props.onViewChange(e,t.target.value)},render:function(){return React.createElement("div",null,React.createElement("section",null,React.createElement("h3",null,"Front"),React.createElement("textarea",{className:"sectionContent",value:this.props.view.front,rows:(this.props.view.front.match(/\n/g)||[]).length+1,onChange:this.onViewChange.bind(this,"front")})),React.createElement("section",null,React.createElement("h3",null,"Back"),React.createElement("textarea",{className:"sectionContent",value:this.props.view.back,rows:(this.props.view.back.match(/\n/g)||[]).length+1,onChange:this.onViewChange.bind(this,"back")})),React.createElement("section",null,React.createElement("h3",null,"Filter"),React.createElement("input",{className:"sectionContent",value:this.props.view.condition,onChange:this.onViewChange.bind(this,"condition")})))}});